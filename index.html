<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Restauracji z Darmową Wodą</title>

    <!-- Dołączanie stylów Leaflet.js (konieczne dla mapy) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <!-- Dołączanie Twoich własnych stylów CSS (musi być w tym samym folderze) -->
    <link rel="stylesheet" href="style.css">

    <!-- Dołączanie fontów Google Fonts dla nowoczesnego, czystego wyglądu -->
    <!-- Quicksand dla nagłówków, Lato dla treści -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <h1>💧 Mapa Restauracji z Darmową Wodą</h1>
        <p>Znajdź miejsca, gdzie bezpłatnie uzupełnisz swoją butelkę. Wspólnie budujmy świadomą i nawodnioną społeczność!</p>
    </header>

    <main>
        <!-- Kontener, w którym zostanie załadowana mapa -->
        <div id="map"></div>

        <!-- Sekcja dla Użytkowników (formularz sugestii) -->
        <div class="container">
            <div class="suggestion-box">
                <h2>Zaproponuj nowe miejsce!</h2>
                <p class="section-description">Znasz restaurację, kawiarnię lub inny punkt, który chętnie oferuje darmową wodę? Daj nam znać!</p>
                
                <!-- TUTAJ MUSISZ WSTAWIĆ SWÓJ ADRES URL Z FORMSPREE.IO -->
                <form action="https://formspree.io/f/xjkrlreo" method="POST" class="suggestion-form">
                    <label for="restaurant_name">Nazwa Miejsca:</label>
                    <input type="text" id="restaurant_name" name="Nazwa Miejsca" required>

                    <label for="location_details">Adres lub Lokalizacja (jak najdokładniej):</label>
                    <input type="text" id="location_details" name="Adres lub Lokalizacja" placeholder="np. ul. Długa 5, Gdańsk / Rynek Główny, obok fontanny" required>

                    <label for="why_water">Dlaczego oferują darmową wodę?</label>
                    <textarea id="why_water" name="Dlaczego Darmowa Woda" placeholder="Np. mają kranik do uzupełniania, widziałem znak, obsługa potwierdziła." required></textarea>

                    <label for="user_email">Twój e-mail (opcjonalnie, do kontaktu):</label>
                    <input type="email" id="user_email" name="_replyto" placeholder="twój.email@example.com">

                    <!-- Pole dla podstawowej ochrony przed spamem Formspree -->
                    <input type="text" name="_gotcha" style="display:none" />

                    <button type="submit">Wyślij Sugestię</button>
                </form>
                <p class="form-info">Po wysłaniu sugestii możesz zostać poproszony o weryfikację "Nie jestem robotem".</p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2023 Mapa Restauracji z Darmową Wodą. Projekt dla społeczności. | <a href="#" target="_blank">Polityka Prywatności</a></p>
    </footer>

    <!-- Dołączanie biblioteki Leaflet.js (konieczne dla mapy) -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Twój własny kod JavaScript -->
    <script>
        // 1. Inicjalizacja mapy
        // Ustawienie domyślnego widoku mapy na centrum Poznania i odpowiedni zoom
        var map = L.map('map').setView([52.40637, 16.92510], 14); // Współrzędne Placu Wolności w Poznaniu, zoom 14

        // 2. Dodanie kafelków mapowych (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // 3. Niestandardowy marker - to jest ikona kropli wody!
        var waterIcon = L.icon({
            iconUrl: 'water_drop_marker.svg', // Ścieżka do Twojego pliku SVG
            iconSize: [35, 35], // Rozmiar ikony (szerokość, wysokość)
            iconAnchor: [17, 35], // Punkt "zakotwiczenia" ikony (dolny środek kropli)
            popupAnchor: [0, -30] // Punkt "zakotwiczenia" popupu względem ikony
        });

        // 4. Dane o restauracjach (Tutaj Ty, jako właściciel, dodajesz/edytujesz swoje restauracje)
        var restaurants = [
            // Restauracje w Poznaniu
            { 
                name: 'Zen On (Poznań)', 
                lat: 52.4172, 
                lon: 16.9069, 
                description: 'Wege/wegańska restauracja, często z darmową wodą do posiłku.' 
            },
            { 
                name: 'Madara (Poznań)', 
                lat: 52.4137, 
                lon: 16.9026, 
                description: 'Bliskowschodnia kuchnia, miła obsługa, woda dostępna.' 
            },
            { 
                name: 'Starg (Poznań)', 
                lat: 52.4150, 
                lon: 16.9000, 
                description: 'Kawiarnia z kawą speciality i darmową wodą.' 
            },
            { 
                name: 'Mówishmash (Poznań)', 
                lat: 52.4004, 
                lon: 16.9157, 
                description: 'Pyszne hummasy, zawsze dbają o nawodnienie klientów.' 
            },
            { 
                name: 'Trzecia Kawa (Poznań)', 
                lat: 52.4077, 
                lon: 16.9298, 
                description: 'Przyjemna kawiarnia w centrum, uzupełnisz bidon.' 
            },
            { 
                name: 'Mitte (Poznań)', 
                lat: 52.4087, 
                lon: 16.9262, 
                description: 'Modne miejsce, zapytaj o wodę do stolika.' 
            },
            { 
                name: 'Tonari (Poznań)', 
                lat: 52.4069, 
                lon: 16.9295, 
                description: 'Japońska kuchnia, kulturalna obsługa chętnie polewa wodę.' 
            },
            // Tutaj możesz dodawać więcej restauracji po ich weryfikacji.
            // PAMIĘTAJ O PRZECINKU PO KAŻDYM OBIECIE, OPRÓCZ OSTATNIEGO!
            // { name: 'Nazwa Restauracji', lat: [szerokość_geograficzna], lon: [długość_geograficzna], description: 'Opis' },
        ];

        // 5. Dodawanie markerów dla każdej restauracji z niestandardową ikoną
        restaurants.forEach(function(restaurant) {
            var marker = L.marker([restaurant.lat, restaurant.lon], {icon: waterIcon}).addTo(map);
            marker.bindPopup(
                "<b>" + restaurant.name + "</b><br>" + 
                (restaurant.description ? restaurant.description : "Brak szczegółowego opisu.")
            );
        });

        // 6. Funkcja do lokalizacji użytkownika (opcjonalne)
        // Ta funkcja nadal działa, ale mapa początkowo jest już wyśrodkowana na Poznaniu.
        // Jeśli użytkownik pozwoli na lokalizację, mapa przeskoczy do jego pozycji.
        function onLocationFound(e) {
            var radius = e.accuracy / 2;
            L.marker(e.latlng).addTo(map)
                .bindPopup("Jesteś w promieniu " + radius + " metrów od tego punktu").openPopup();
            L.circle(e.latlng, radius).addTo(map);
            map.setView(e.latlng, 14); // Ustaw widok mapy na Twoją lokalizację
        }

        function onLocationError(e) {
            console.error("Błąd lokalizacji: " + e.message + ". Mapa pozostaje wyśrodkowana na Poznaniu.");
            // Możesz dodać tutaj alert, jeśli chcesz, aby użytkownik był powiadamiany o błędzie lokalizacji.
            // alert("Nie udało się ustalić Twojej lokalizacji. Mapa jest wyśrodkowana na Poznaniu.");
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        // Spróbuj zlokalizować użytkownika po załadowaniu mapy, ale bez zmiany domyślnego widoku,
        // chyba że lokalizacja jest naprawdę dokładna.
        map.locate({setView: false, maxZoom: 16, enableHighAccuracy: true});

        // 7. Funkcja dla Ciebie (właściciela): po kliknięciu na mapie pokaże współrzędne
        var popup = L.popup();

        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent("Współrzędne kliknięcia:<br>" + 
                            "Lat: " + e.latlng.lat.toFixed(6) + "<br>" + 
                            "Lon: " + e.latlng.lng.toFixed(6) +
                            "<br>Skopiuj i wklej do pliku `index.html`!")
                .openOn(map);
        }
        map.on('click', onMapClick);

    </script>

</body>
</html>
